{"version":3,"file":"render-panorama.js","sourceRoot":"","sources":["../../../src/plugins/render-panorama.ts"],"names":[],"mappings":"AAAA,OAAO,KAAK,UAAU,MAAM,SAAS,CAAA;AAGrC,CAAC,GAAG,EAAE;IAEN,MAAM,IAAI,GAAG,UAAU,CAAA;IAMvB,kBAAkB,IAAI;QACpB,MAAM,CAAC,UAAU,CAAC,cAAc,CAAC,IAAI,EAAE,IAAI,CAAkB,CAAA;IAC/D,CAAC;IAED,gBAAgB,CAAC,EAAE,IAAqB;QACtC,MAAM,KAAK,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAA;QAC5B,MAAM,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAA;QAC9B,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;YACZ,MAAM,CAAA;QACR,CAAC;QAED,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,KAAK,YAAY,CAAC,CAAC,CAAC;YACtC,KAAK,CAAC,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,GAAG,MAAM,CAAC,aAAa,CAAA;YAC9D,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,YAAY,CAAA;QACnC,CAAC;QAAC,IAAI,CAAC,CAAC;YACN,KAAK,CAAC,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,UAAU,EAAE,GAAG,MAAM,CAAC,YAAY,CAAA;YAC5D,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,aAAa,CAAA;QACpC,CAAC;QACD,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,YAAY,GAAG,KAAK,CAAC,KAAK,CAAC,CAAA;QAC3D,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,aAAa,GAAG,KAAK,CAAC,KAAK,CAAC,CAAA;QAC7D,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC;YACb,kBAAkB,EAAU,OAAO,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,CAAC,GAAG;YAC5D,mBAAmB,EAAS,aAAa;YACzC,4DAA4D;YAC5D,yBAAyB,EAAG,GAAG,KAAK,MAAM,MAAM,IAAI;YACpD,sBAAsB,EAAM,GAAG,KAAK,MAAM,MAAM,IAAI;YACpD,oBAAoB,EAAQ,GAAG,KAAK,MAAM,MAAM,IAAI;YACpD,iBAAiB,EAAW,GAAG,KAAK,MAAM,MAAM,IAAI,CAAE,iDAAiD;SACxG,CAAC,CAAA;IACJ,CAAC;IAED,gBAAgB,CAAC,EAAE,IAAqB;QACtC,MAAM,KAAK,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAA;QAC5B,MAAM,EAAE,GAAG,IAAI,CAAC,WAAW,KAAK,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;QACpD,MAAM,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;QAErB,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,MAAM,CAAA;QACvC,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,EAAE,GAAG,MAAM,GAAG,KAAK,CAAC,KAAK,CAAC,CAAA;QAClD,MAAM,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,EAAE,GAAG,MAAM,GAAG,KAAK,CAAC,KAAK,CAAC,CAAA;QACjD,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,qBAAqB,EAAG,GAAG,IAAI,MAAM,GAAG,IAAI,EAAE,CAAC,CAAA;IAClE,CAAC;IAED,UAAU,CAAC,cAAc,CAAC,IAAI,EAAE;QAC9B,IAAI,EAAE,IAAI;QACV,MAAM,EAAE,MAAM;QACd,MAAM,EAAE,MAAM;KACf,CAAC,CAAA;AAEF,CAAC,CAAC,EAAE,CAAA","sourcesContent":["import * as SpriteSpin from '../core'\nimport * as Utils from '../utils'\n\n(() => {\n\nconst NAME = 'panorama'\n\ninterface PanoramaState {\n  scale: number\n}\n\nfunction getState(data) {\n  return SpriteSpin.getPluginState(data, NAME) as PanoramaState\n}\n\nfunction onLoad(e, data: SpriteSpin.Data) {\n  const state = getState(data)\n  const sprite = data.metrics[0]\n  if (!sprite) {\n    return\n  }\n\n  if (data.orientation === 'horizontal') {\n    state.scale = data.target.innerHeight() / sprite.sampledHeight\n    data.frames = sprite.sampledWidth\n  } else {\n    state.scale = data.target.innerWidth() / sprite.sampledWidth\n    data.frames = sprite.sampledHeight\n  }\n  const width = Math.floor(sprite.sampledWidth * state.scale)\n  const height = Math.floor(sprite.sampledHeight * state.scale)\n  data.stage.css({\n    'background-image'        : `url(${data.source[sprite.id]})`,\n    'background-repeat'       : 'repeat-both',\n    // set custom background size to enable responsive rendering\n    '-webkit-background-size' : `${width}px ${height}px`, /* Safari 3-4 Chrome 1-3 */\n    '-moz-background-size'    : `${width}px ${height}px`, /* Firefox 3.6 */\n    '-o-background-size'      : `${width}px ${height}px`, /* Opera 9.5 */\n    'background-size'         : `${width}px ${height}px`  /* Chrome, Firefox 4+, IE 9+, Opera, Safari 5+ */\n  })\n}\n\nfunction onDraw(e, data: SpriteSpin.Data) {\n  const state = getState(data)\n  const px = data.orientation === 'horizontal' ? 1 : 0\n  const py = px ? 0 : 1\n\n  const offset = data.frame % data.frames\n  const left = Math.round(px * offset * state.scale)\n  const top = Math.round(py * offset * state.scale)\n  data.stage.css({ 'background-position' : `${left}px ${top}px` })\n}\n\nSpriteSpin.registerPlugin(NAME, {\n  name: NAME,\n  onLoad: onLoad,\n  onDraw: onDraw\n})\n\n})()\n"]}