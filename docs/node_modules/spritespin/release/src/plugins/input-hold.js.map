{"version":3,"file":"input-hold.js","sourceRoot":"","sources":["../../../src/plugins/input-hold.ts"],"names":[],"mappings":"AAAA,OAAO,KAAK,UAAU,MAAM,SAAS,CAAA;AAErC,CAAC;IAED,IAAM,IAAI,GAAG,MAAM,CAAA;IAQnB,kBAAkB,IAAqB;QACrC,MAAM,CAAC,UAAU,CAAC,cAAc,CAAC,IAAI,EAAE,IAAI,CAAc,CAAA;IAC3D,CAAC;IAED,yBAAyB,IAAqB;QAC5C,IAAM,KAAK,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAA;QAC5B,KAAK,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAA;QAChC,KAAK,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAA;QAC5B,KAAK,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAA;IAC9B,CAAC;IAED,wBAAwB,IAAqB;QAC3C,IAAM,KAAK,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAA;QAC5B,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC,SAAS,CAAA;QAChC,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC,OAAO,CAAA;QAC5B,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC,OAAO,CAAA;IAC9B,CAAC;IAED,eAAe,CAAC,EAAE,IAAqB;QACrC,EAAE,CAAC,CAAC,UAAU,CAAC,EAAE,CAAC,IAAI,EAAE,SAAS,CAAC,IAAI,UAAU,CAAC,EAAE,CAAC,IAAI,EAAE,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;YACpG,MAAM,CAAA;QACR,CAAC;QACD,eAAe,CAAC,IAAI,CAAC,CAAA;QACrB,UAAU,CAAC,WAAW,CAAC,CAAC,EAAE,IAAI,CAAC,CAAA;QAC/B,UAAU,CAAC,IAAI,CAAC,IAAI,EAAE,UAAU,EAAE,IAAI,CAAC,CAAA;QACvC,IAAI,CAAC,OAAO,GAAG,IAAI,CAAA;QACnB,UAAU,CAAC,cAAc,CAAC,IAAI,CAAC,CAAA;IACjC,CAAC;IAED,cAAc,CAAC,EAAE,IAAqB;QACpC,UAAU,CAAC,IAAI,CAAC,IAAI,EAAE,UAAU,EAAE,KAAK,CAAC,CAAA;QACxC,UAAU,CAAC,UAAU,CAAC,IAAI,CAAC,CAAA;QAC3B,UAAU,CAAC,aAAa,CAAC,IAAI,CAAC,CAAA;QAC9B,cAAc,CAAC,IAAI,CAAC,CAAA;QACpB,UAAU,CAAC,cAAc,CAAC,IAAI,CAAC,CAAA;IACjC,CAAC;IAED,gBAAgB,CAAC,EAAE,IAAqB;QACtC,EAAE,CAAC,CAAC,CAAC,UAAU,CAAC,EAAE,CAAC,IAAI,EAAE,UAAU,CAAC,CAAC,CAAC,CAAC;YACrC,MAAM,CAAA;QACR,CAAC;QACD,UAAU,CAAC,WAAW,CAAC,CAAC,EAAE,IAAI,CAAC,CAAA;QAC/B,IAAM,KAAK,GAAG,UAAU,CAAC,aAAa,CAAC,IAAI,CAAC,CAAA;QAE5C,IAAI,IAAI,EAAE,KAAK,CAAA;QACf,IAAM,MAAM,GAAG,IAAI,CAAC,MAAM,EAAE,MAAM,GAAG,MAAM,CAAC,MAAM,EAAE,CAAA;QACpD,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,KAAK,YAAY,CAAC,CAAC,CAAC;YACtC,IAAI,GAAG,MAAM,CAAC,UAAU,EAAE,GAAG,CAAC,CAAA;YAC9B,KAAK,GAAG,CAAC,KAAK,CAAC,QAAQ,GAAG,MAAM,CAAC,IAAI,GAAG,IAAI,CAAC,GAAG,IAAI,CAAA;QACtD,CAAC;QAAC,IAAI,CAAC,CAAC;YACN,IAAI,GAAG,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAA;YACxB,KAAK,GAAG,CAAC,KAAK,CAAC,QAAQ,GAAG,MAAM,CAAC,GAAG,GAAG,IAAI,CAAC,GAAG,IAAI,CAAA;QACrD,CAAC;QACD,IAAI,CAAC,OAAO,GAAG,KAAK,GAAG,CAAC,CAAA;QACxB,KAAK,GAAG,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,KAAK,CAAA;QAClC,IAAI,CAAC,SAAS,GAAG,EAAE,GAAG,CAAC,CAAC,GAAG,KAAK,CAAC,GAAG,EAAE,CAAA;QAEtC,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,KAAK,YAAY,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,GAAG,KAAK,CAAC,EAAE,CAAC,CAAC;YAChE,CAAC,CAAC,IAAI,CAAC,WAAW,KAAK,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,GAAG,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;YAC/D,CAAC,CAAC,cAAc,EAAE,CAAA;QACpB,CAAC;IACH,CAAC;IAED,iBAAiB,CAAC,EAAE,IAAqB;QACvC,IAAI,CAAC,OAAO,GAAG,IAAI,CAAA;QACnB,UAAU,CAAC,cAAc,CAAC,IAAI,CAAC,CAAA;IACjC,CAAC;IAED,UAAU,CAAC,cAAc,CAAC,IAAI,EAAE;QAC9B,IAAI,EAAE,IAAI;QAEV,SAAS,EAAE,KAAK;QAChB,SAAS,EAAE,MAAM;QACjB,OAAO,EAAE,IAAI;QACb,UAAU,EAAE,IAAI;QAEhB,UAAU,EAAE,KAAK;QACjB,SAAS,EAAE,MAAM;QACjB,QAAQ,EAAE,IAAI;QACd,WAAW,EAAE,IAAI;QAEjB,OAAO,EAAE,OAAO;KACjB,CAAC,CAAA;AAEF,CAAC,CAAC,EAAE,CAAA","sourcesContent":["import * as SpriteSpin from '../core'\n\n(() => {\n\nconst NAME = 'hold'\n\ninterface HoldState {\n  frameTime: number\n  animate: boolean\n  reverse: boolean\n}\n\nfunction getState(data: SpriteSpin.Data) {\n  return SpriteSpin.getPluginState(data, NAME) as HoldState\n}\n\nfunction rememberOptions(data: SpriteSpin.Data) {\n  const state = getState(data)\n  state.frameTime = data.frameTime\n  state.animate = data.animate\n  state.reverse = data.reverse\n}\n\nfunction restoreOptions(data: SpriteSpin.Data) {\n  const state = getState(data)\n  data.frameTime = state.frameTime\n  data.animate = state.animate\n  data.reverse = state.reverse\n}\n\nfunction start(e, data: SpriteSpin.Data) {\n  if (SpriteSpin.is(data, 'loading') || SpriteSpin.is(data, 'dragging') || !data.stage.is(':visible')) {\n    return\n  }\n  rememberOptions(data)\n  SpriteSpin.updateInput(e, data)\n  SpriteSpin.flag(data, 'dragging', true)\n  data.animate = true\n  SpriteSpin.applyAnimation(data)\n}\n\nfunction stop(e, data: SpriteSpin.Data) {\n  SpriteSpin.flag(data, 'dragging', false)\n  SpriteSpin.resetInput(data)\n  SpriteSpin.stopAnimation(data)\n  restoreOptions(data)\n  SpriteSpin.applyAnimation(data)\n}\n\nfunction update(e, data: SpriteSpin.Data) {\n  if (!SpriteSpin.is(data, 'dragging')) {\n    return\n  }\n  SpriteSpin.updateInput(e, data)\n  const input = SpriteSpin.getInputState(data)\n\n  let half, delta\n  const target = data.target, offset = target.offset()\n  if (data.orientation === 'horizontal') {\n    half = target.innerWidth() / 2\n    delta = (input.currentX - offset.left - half) / half\n  } else {\n    half = (data.height / 2)\n    delta = (input.currentY - offset.top - half) / half\n  }\n  data.reverse = delta < 0\n  delta = delta < 0 ? -delta : delta\n  data.frameTime = 80 * (1 - delta) + 20\n\n  if (((data.orientation === 'horizontal') && (input.dX < input.dY)) ||\n    ((data.orientation === 'vertical') && (input.dX < input.dY))) {\n    e.preventDefault()\n  }\n}\n\nfunction onFrame(e, data: SpriteSpin.Data) {\n  data.animate = true\n  SpriteSpin.applyAnimation(data)\n}\n\nSpriteSpin.registerPlugin(NAME, {\n  name: NAME,\n\n  mousedown: start,\n  mousemove: update,\n  mouseup: stop,\n  mouseleave: stop,\n\n  touchstart: start,\n  touchmove: update,\n  touchend: stop,\n  touchcancel: stop,\n\n  onFrame: onFrame\n})\n\n})()\n"]}