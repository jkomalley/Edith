{"version":3,"file":"render-360.js","sourceRoot":"","sources":["../../../src/plugins/render-360.ts"],"names":[],"mappings":"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","sourcesContent":["import * as SpriteSpin from '../core'\nimport * as Utils from '../utils'\n\n(() => {\n\nconst floor = Math.floor\n\nconst NAME = '360'\n\nfunction onLoad(e, data: SpriteSpin.Data) {\n  data.stage.find('.spritespin-frames').detach()\n  if (data.renderer === 'image') {\n    $(data.images).addClass('spritespin-frames').appendTo(data.stage)\n  }\n}\n\nfunction onDraw(e, data: SpriteSpin.Data) {\n  const specs = Utils.findSpecs(data.metrics, data.frames, data.frame, data.lane)\n  const sheet = specs.sheet\n  const sprite = specs.sprite\n\n  if (!sheet || !sprite) { return }\n  const src = data.source[sheet.id]\n  const image = data.images[sheet.id]\n\n  if (data.renderer === 'canvas') {\n    data.canvas.show()\n    const w = data.canvas[0].width / data.canvasRatio\n    const h = data.canvas[0].height / data.canvasRatio\n    data.context.clearRect(0, 0, w, h)\n    data.context.drawImage(image, sprite.sampledX, sprite.sampledY, sprite.sampledWidth, sprite.sampledHeight, 0, 0, w, h)\n    return\n  }\n\n  const scaleX = data.stage.innerWidth() / sprite.sampledWidth\n  const scaleY = data.stage.innerHeight() / sprite.sampledHeight\n  const top = Math.floor(-sprite.sampledY * scaleY)\n  const left = Math.floor(-sprite.sampledX * scaleX)\n  const width = Math.floor(sheet.sampledWidth * scaleX)\n  const height = Math.floor(sheet.sampledHeight * scaleY)\n  if (data.renderer === 'background') {\n    data.stage.css({\n      'background-image'    : `url('${src}')`,\n      'background-position' : `${left}px ${top}px`,\n      'background-repeat'   : 'no-repeat',\n      // set custom background size to enable responsive rendering\n      '-webkit-background-size' : `${width}px ${height}px`, /* Safari 3-4 Chrome 1-3 */\n      '-moz-background-size'    : `${width}px ${height}px`, /* Firefox 3.6 */\n      '-o-background-size'      : `${width}px ${height}px`, /* Opera 9.5 */\n      'background-size'         : `${width}px ${height}px`  /* Chrome, Firefox 4+, IE 9+, Opera, Safari 5+ */\n    })\n    return\n  }\n\n  $(data.images).hide()\n  $(image).show().css({\n    position: 'absolute',\n    top: top,\n    left: left,\n    'max-width' : 'initial',\n    width: width,\n    height: height\n  })\n}\n\nSpriteSpin.registerPlugin(NAME, {\n  name: NAME,\n  onLoad,\n  onDraw\n})\n\n})()\n"]}